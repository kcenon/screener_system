# [DP-001] Apache Airflow Environment Setup

## Metadata
- **Status**: TODO
- **Priority**: High
- **Assignee**: TBD
- **Estimated Time**: 6 hours
- **Sprint**: Sprint 1 (Week 2)
- **Tags**: #data-pipeline #airflow #setup

## Description
Set up Apache Airflow environment for orchestrating daily data ingestion and indicator calculation workflows.

## Subtasks
- [ ] Install Apache Airflow
  - [ ] Create Python virtual environment
  - [ ] Install airflow==2.8.0 with PostgreSQL and Celery support
  - [ ] Install providers: apache-airflow-providers-postgres
- [ ] Airflow Configuration
  - [ ] Set AIRFLOW_HOME environment variable
  - [ ] Configure airflow.cfg
    - [ ] executor = LocalExecutor (dev) / CeleryExecutor (prod)
    - [ ] sql_alchemy_conn (Airflow metadata DB)
    - [ ] load_examples = False
    - [ ] parallelism = 32
    - [ ] max_active_runs_per_dag = 1
- [ ] Initialize Airflow Database
  - [ ] `airflow db init`
  - [ ] Create Airflow metadata tables
- [ ] Create Admin User
  - [ ] `airflow users create --role Admin`
  - [ ] Set username, password, email
- [ ] Configure Connections
  - [ ] PostgreSQL connection (screener_db)
    - [ ] Connection ID: screener_db
    - [ ] Host, port, database, user, password
  - [ ] Test connection: `airflow connections test screener_db`
- [ ] Directory Structure
  - [ ] data_pipeline/dags/ (DAG definitions)
  - [ ] data_pipeline/plugins/ (custom operators)
  - [ ] data_pipeline/config/ (configuration files)
  - [ ] data_pipeline/scripts/ (utility scripts)
- [ ] Start Airflow Services
  - [ ] Webserver: `airflow webserver --port 8080`
  - [ ] Scheduler: `airflow scheduler`
- [ ] SMTP Configuration (for alerts)
  - [ ] Configure smtp settings in airflow.cfg
  - [ ] Set email_backend
  - [ ] Test email sending

## Acceptance Criteria
- [ ] Airflow webserver accessible at http://localhost:8080
- [ ] Login successful with admin credentials
- [ ] Airflow UI shows no errors
- [ ] DAGs folder monitored correctly
- [ ] screener_db connection test passes
- [ ] Scheduler running without errors: `airflow scheduler` logs
- [ ] Can trigger manual DAG run from UI
- [ ] Email alerts configured (test email sent successfully)

## Dependencies
- **Depends on**: DB-001, DB-002
- **Blocks**: DP-002, DP-003

## References
- **SDS.md**: Section 6.1 Apache Airflow Architecture
- **data_pipeline/README.md**: Setup instructions
- [Airflow Installation](https://airflow.apache.org/docs/apache-airflow/stable/installation/)
- [Airflow Configuration](https://airflow.apache.org/docs/apache-airflow/stable/configurations-ref.html)

## Progress
- **0%** - Not started

## Notes
- Use LocalExecutor for development (simpler)
- Consider CeleryExecutor for production (parallel task execution)
- Airflow metadata DB separate from application DB
- Set timezone to Asia/Seoul (KST)
